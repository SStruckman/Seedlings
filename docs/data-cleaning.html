<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 6 Data Cleaning | Raw Data Cleaning</title>
  <meta name="description" content="This book documents some exploration of a dataset on Pinus seedlings in the Utah Forest Dynamics plot in Cedar Breaks, UT." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 6 Data Cleaning | Raw Data Cleaning" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book documents some exploration of a dataset on Pinus seedlings in the Utah Forest Dynamics plot in Cedar Breaks, UT." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 6 Data Cleaning | Raw Data Cleaning" />
  
  <meta name="twitter:description" content="This book documents some exploration of a dataset on Pinus seedlings in the Utah Forest Dynamics plot in Cedar Breaks, UT." />
  

<meta name="author" content="Soren Struckman" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-import.html"/>
<link rel="next" href="grid-physical-data-derivation.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">UFDP Pinus Seedlings</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Background</a></li>
<li class="chapter" data-level="2" data-path="data-description.html"><a href="data-description.html"><i class="fa fa-check"></i><b>2</b> Data Description</a></li>
<li class="chapter" data-level="3" data-path="database-creation.html"><a href="database-creation.html"><i class="fa fa-check"></i><b>3</b> Database Creation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="database-creation.html"><a href="database-creation.html#initialization"><i class="fa fa-check"></i><b>3.1</b> Initialization</a></li>
<li class="chapter" data-level="3.2" data-path="database-creation.html"><a href="database-creation.html#import-data"><i class="fa fa-check"></i><b>3.2</b> Import Data</a></li>
<li class="chapter" data-level="3.3" data-path="database-creation.html"><a href="database-creation.html#create-database"><i class="fa fa-check"></i><b>3.3</b> Create Database</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="initialization-1.html"><a href="initialization-1.html"><i class="fa fa-check"></i><b>4</b> Initialization</a></li>
<li class="chapter" data-level="5" data-path="data-import.html"><a href="data-import.html"><i class="fa fa-check"></i><b>5</b> Data Import</a></li>
<li class="chapter" data-level="6" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>6</b> Data Cleaning</a>
<ul>
<li class="chapter" data-level="6.1" data-path="data-cleaning.html"><a href="data-cleaning.html#seedling"><i class="fa fa-check"></i><b>6.1</b> Seedling</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="data-cleaning.html"><a href="data-cleaning.html#export"><i class="fa fa-check"></i><b>6.1.1</b> Export</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="data-cleaning.html"><a href="data-cleaning.html#mortality"><i class="fa fa-check"></i><b>6.2</b> Mortality</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="data-cleaning.html"><a href="data-cleaning.html#export-1"><i class="fa fa-check"></i><b>6.2.1</b> Export</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="grid-physical-data-derivation.html"><a href="grid-physical-data-derivation.html"><i class="fa fa-check"></i><b>7</b> Grid Physical Data Derivation</a></li>
<li class="chapter" data-level="8" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>8</b> Introduction</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Raw Data Cleaning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-cleaning" class="section level1" number="6">
<h1><span class="header-section-number">Section 6</span> Data Cleaning</h1>
<div id="seedling" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Seedling</h2>
<p>Let’s make a new data.frame to store the clean data. This way, we can make changes to that without messing with the raw data at all.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-cleaning.html#cb12-1" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">=</span> seed.raw</span></code></pre></div>
<p>There are several columns in this dataset that are remnants of the upstream data source and are not applicable/useful for dealing with seedlings. We can remove them.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-cleaning.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#extract any columns that are entirely empty and remove them</span></span>
<span id="cb13-2"><a href="data-cleaning.html#cb13-2" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb13-3"><a href="data-cleaning.html#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">colnames</span>(seed)){</span>
<span id="cb13-4"><a href="data-cleaning.html#cb13-4" aria-hidden="true" tabindex="-1"></a>     <span class="cf">if</span>(<span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(seed[,i])) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb13-5"><a href="data-cleaning.html#cb13-5" aria-hidden="true" tabindex="-1"></a>          tmp <span class="ot">=</span> <span class="fu">c</span>(tmp,i)</span>
<span id="cb13-6"><a href="data-cleaning.html#cb13-6" aria-hidden="true" tabindex="-1"></a>     }</span>
<span id="cb13-7"><a href="data-cleaning.html#cb13-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb13-8"><a href="data-cleaning.html#cb13-8" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">=</span> seed <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">all_of</span>(tmp))</span></code></pre></div>
<p>FLAG, PLOT, CTFS_DA, CORED, DATA_ENTRY, DATA_CHECK, and some of the original mapping variables are also irrelevant or redundant, so we will remove them too.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-cleaning.html#cb14-1" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">=</span> seed <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>((<span class="sc">-</span><span class="fu">c</span>(FLAG, PLOT, CTFS_DA, CORED, DATA_ENTRY_1, DATA_ENTRY_2, DATA_CHECK, </span>
<span id="cb14-2"><a href="data-cleaning.html#cb14-2" aria-hidden="true" tabindex="-1"></a>                                  REFERENCE, DISTANCE, AZIMUTH, PLOT_X, PLOT_Y, FIELD_X, FIELD_Y)))</span></code></pre></div>
<p>There are some “seedlings” in this dataset that were large enough to have a DBH&gt;=1 (thus qualifying them as a full tree, and not a seedling) and were that size when they entered the dataset (either when the plot was established or when that stem was found and tagged). I believe seedling data was taken on these in order to construct models to relate basal diameter (DBA or BD) and diameter at breast height (DBH). We want to keep these somewhere to show those relationships, but not in the main dataset that we will use for the other analyses, so let’s put them in their own file.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-cleaning.html#cb15-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">=</span> seed <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="data-cleaning.html#cb15-2" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(STEM_TAG) <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="data-cleaning.html#cb15-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">CENSUS_ENTRIES =</span> <span class="fu">str_c</span>(CENSUS, <span class="at">collapse=</span><span class="st">&#39;-&#39;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="data-cleaning.html#cb15-4" aria-hidden="true" tabindex="-1"></a>        <span class="co"># selects all the stems whose first measurement in the study was DBH=1+</span></span>
<span id="cb15-5"><a href="data-cleaning.html#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>((CENSUS<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> DBH<span class="sc">&gt;=</span><span class="dv">1</span>) <span class="sc">|</span> </span>
<span id="cb15-6"><a href="data-cleaning.html#cb15-6" aria-hidden="true" tabindex="-1"></a>                (<span class="sc">!</span><span class="fu">str_detect</span>(CENSUS_ENTRIES, <span class="at">pattern=</span><span class="st">&#39;1&#39;</span>) <span class="sc">&amp;</span> CENSUS<span class="sc">!=</span><span class="dv">6</span> <span class="sc">&amp;</span> DBH<span class="sc">&gt;=</span><span class="dv">1</span>) <span class="sc">|</span> </span>
<span id="cb15-7"><a href="data-cleaning.html#cb15-7" aria-hidden="true" tabindex="-1"></a>                (CENSUS_ENTRIES<span class="sc">==</span><span class="st">&#39;6&#39;</span> <span class="sc">&amp;</span> DBH<span class="sc">&gt;=</span><span class="dv">1</span>))</span>
<span id="cb15-8"><a href="data-cleaning.html#cb15-8" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb15-9"><a href="data-cleaning.html#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#partitions all the data for those stem tags into a new dataset</span></span>
<span id="cb15-10"><a href="data-cleaning.html#cb15-10" aria-hidden="true" tabindex="-1"></a>saplings <span class="ot">=</span> seed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(STEM_TAG <span class="sc">%in%</span> tmp<span class="sc">$</span>STEM_TAG)</span>
<span id="cb15-11"><a href="data-cleaning.html#cb15-11" aria-hidden="true" tabindex="-1"></a>seed <span class="ot">=</span> seed <span class="sc">%&gt;%</span> <span class="fu">filter</span>(STEM_TAG <span class="sc">%notin%</span> tmp<span class="sc">$</span>STEM_TAG)</span></code></pre></div>
<div id="export" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Export</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-cleaning.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(saplings, <span class="fu">paste0</span>(<span class="st">&#39;./Data_clean/Sapling_clean_&#39;</span>,<span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">&quot;%Y%m%d&quot;</span>),<span class="st">&#39;.csv&#39;</span>))</span>
<span id="cb16-2"><a href="data-cleaning.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(seed, <span class="fu">paste0</span>(<span class="st">&#39;./Data_clean/Seedling_clean_&#39;</span>,<span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">&quot;%Y%m%d&quot;</span>),<span class="st">&#39;.csv&#39;</span>))</span></code></pre></div>
</div>
</div>
<div id="mortality" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Mortality</h2>
<p>A few of the saplings also have since died, so we should remove them from the mortality data. Other than that, this data is already pretty clean.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-cleaning.html#cb17-1" aria-hidden="true" tabindex="-1"></a>mort <span class="ot">=</span> mort.raw <span class="sc">%&gt;%</span> <span class="fu">filter</span>(STEM_TAG <span class="sc">%notin%</span> tmp<span class="sc">$</span>STEM_TAG)</span></code></pre></div>
<div id="export-1" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Export</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-cleaning.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(mort, <span class="fu">paste0</span>(<span class="st">&#39;./Data_clean/Mort_clean_&#39;</span>,<span class="fu">format</span>(<span class="fu">Sys.time</span>(), <span class="st">&quot;%Y%m%d&quot;</span>),<span class="st">&#39;.csv&#39;</span>))</span></code></pre></div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-import.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="grid-physical-data-derivation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Seedlings_Book.pdf", "Seedlings_Book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
